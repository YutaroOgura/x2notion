# ã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼è¨­è¨ˆã‚¬ã‚¤ãƒ‰ï¼ˆRedis + Laravel Queueï¼‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ Laravel ã®ã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã€Redis ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ¯ ä½¿ç”¨æŠ€è¡“

- ã‚­ãƒ¥ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒï¼šRedis
- ã‚¸ãƒ§ãƒ–ç®¡ç†ï¼šLaravel Queue
- ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–ï¼šSupervisorï¼ˆé–‹ç™ºã§ã¯ Laradock çµŒç”±ï¼‰

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹

- `app/Jobs/`ï¼šå…¨ã¦ã®ã‚¸ãƒ§ãƒ–ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©
- `app/Listeners/`ï¼šã‚¤ãƒ™ãƒ³ãƒˆã«å¿œã˜ãŸéåŒæœŸå‡¦ç†
- `config/queue.php`ï¼šè¨­å®šã¯ redis ã«çµ±ä¸€

---

## ğŸ” ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥

- å„ã‚¸ãƒ§ãƒ–ã¯ `tries`, `timeout`, `backoff` ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
- å¤±æ•—ã—ãŸã‚¸ãƒ§ãƒ–ã¯ `failed_jobs` ãƒ†ãƒ¼ãƒ–ãƒ«ã§è¨˜éŒ²ã€å¿…è¦ã«å¿œã˜ã¦ `retry` ã‚³ãƒãƒ³ãƒ‰ã§å†é€
- æ°¸ç¶šçš„ãªå¤±æ•—ï¼ˆä¾‹ï¼šå­˜åœ¨ã—ãªã„ãƒ¦ãƒ¼ã‚¶ãªã©ï¼‰ã¯ retry ã—ãªã„è¨­è¨ˆã«ã™ã‚‹

---

## âš™ Supervisor è¨­å®šä¾‹

```
[program:laravel-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/artisan queue:work redis --sleep=3 --tries=3 --timeout=90
autostart=true
autorestart=true
user=laradock
numprocs=1
redirect_stderr=true
stdout_logfile=/var/www/storage/logs/worker.log
```

---

## ğŸ“Œ ãã®ä»–ãƒãƒªã‚·ãƒ¼

- è»½é‡å‡¦ç†ã¯ sync or dispatchNow()ã€é‡ã„å‡¦ç†ã¯ dispatch()
- ã‚¸ãƒ§ãƒ–ã® idempotentï¼ˆå†ªç­‰æ€§ï¼‰ã‚’æ„è­˜ã™ã‚‹

# アーキテクチャ構成図

## 1. 全体システム構成

```
┌─────────────────────────────────────────────────────────────────────┐
│                        X2Notionシステム                              │
│                                                                     │
│  ┌───────────┐     ┌───────────┐     ┌───────────┐                  │
│  │           │     │           │     │           │                  │
│  │   n8n     │◄───►│  Python   │◄───►│  Laravel  │                  │
│  │           │     │           │     │           │                  │
│  └─────┬─────┘     └─────┬─────┘     └─────┬─────┘                  │
│        │                 │                 │                        │
└────────┼─────────────────┼─────────────────┼────────────────────────┘
         │                 │                 │
         ▼                 │                 ▼
┌─────────────────┐        │        ┌─────────────────┐
│                 │        │        │                 │
│  外部サービス   │        │        │   管理UI/API    │
│  - X API        │        │        │   - 履歴閲覧    │
│  - Notion API   │        │        │   - 統計表示    │
│  - OpenAI API   │        │        │   - 設定管理    │
│  - Slack API    │        │        │                 │
│  - LINE API     │        │        │                 │
│                 │        │        │                 │
└─────────────────┘        │        └─────────────────┘
                           │
                           ▼
                  ┌─────────────────┐
                  │                 │
                  │  テキスト処理   │
                  │  - 前処理       │
                  │  - 長文分割     │
                  │  - 正規化       │
                  │                 │
                  └─────────────────┘
```

## 2. コンポーネント構成

### 2.1 n8n（ワークフロー自動化エンジン）

```
┌─────────────────────────────────────────────────────────────────┐
│                           n8n                                   │
│                                                                 │
│  ┌───────────────────┐   ┌───────────────────┐                  │
│  │                   │   │                   │                  │
│  │ X投稿取得フロー   │   │ AI応答フロー      │                  │
│  │ - 定期実行        │   │ - Slack/LINE受信  │                  │
│  │ - X API連携       │   │ - Notion DB検索   │                  │
│  │ - Notion保存      │   │ - OpenAI連携      │                  │
│  │                   │   │ - 応答送信        │                  │
│  └───────────────────┘   └───────────────────┘                  │
│                                                                 │
│  ┌───────────────────┐                                          │
│  │                   │                                          │
│  │ エラー通知フロー  │                                          │
│  │ - エラー検知      │                                          │
│  │ - Slack通知       │                                          │
│  │ - ログ記録        │                                          │
│  │                   │                                          │
│  └───────────────────┘                                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 データフロー図

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│          │     │          │     │          │     │          │
│  X API   │────►│   n8n    │────►│  Notion  │────►│ Notion DB│
│          │     │          │     │   API    │     │          │
└──────────┘     └──────────┘     └──────────┘     └──────────┘


┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│          │     │          │     │          │     │          │
│  Slack/  │────►│   n8n    │────►│  Python  │────►│  OpenAI  │
│   LINE   │     │          │     │          │     │          │
└──────────┘     └──────────┘     └──────────┘     └──────────┘
                      │                                 │
                      │                                 │
                      ▼                                 ▼
                 ┌──────────┐                     ┌──────────┐
                 │          │                     │          │
                 │ Laravel  │◄────────────────────┤  Slack/  │
                 │          │                     │   LINE   │
                 └──────────┘                     └──────────┘
```

## 3. デプロイメント構成

```
┌─────────────────────────────────────────────────────────────────┐
│                      Docker Compose                             │
│                                                                 │
│  ┌───────────────┐   ┌───────────────┐   ┌───────────────┐      │
│  │               │   │               │   │               │      │
│  │  n8n コンテナ │   │ Python コンテナ│   │Laravel コンテナ│      │
│  │  Port: 5678   │   │  Port: 5000   │   │  Port: 8000   │      │
│  │               │   │               │   │               │      │
│  └───────────────┘   └───────────────┘   └───────────────┘      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 4. 認証・セキュリティ構成

```
┌─────────────────────────────────────────────────────────────────┐
│                    認証・セキュリティ                           │
│                                                                 │
│  ┌───────────────┐   ┌───────────────┐   ┌───────────────┐      │
│  │               │   │               │   │               │      │
│  │  API キー管理 │   │  Basic認証    │   │ Laravel認証   │      │
│  │  (.env)       │   │  (n8n)        │   │ (Sanctum)     │      │
│  │               │   │               │   │               │      │
│  └───────────────┘   └───────────────┘   └───────────────┘      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```
